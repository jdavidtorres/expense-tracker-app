<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ExpenseTracker.ViewModels"
             x:Class="ExpenseTracker.Views.SubscriptionFormPage"
             Title="{Binding FormTitle}">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Save"
                     Command="{Binding SaveCommand}"
                     IconImageSource="save.png"/>
        <ToolbarItem Text="Cancel"
                     Command="{Binding CancelCommand}"
                     IconImageSource="cancel.png"/>
    </ContentPage.ToolbarItems>

    <Grid>
        <!-- Loading indicator -->
        <ActivityIndicator IsVisible="{Binding IsLoading}"
                           IsRunning="{Binding IsLoading}"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"/>

        <!-- Error message -->
        <Border IsVisible="{Binding HasError}"
               BackgroundColor="Red"
               Padding="16"
               Margin="16"
               VerticalOptions="Start">
            <Label Text="{Binding ErrorMessage}"
                   TextColor="White"
                   HorizontalOptions="Center"/>
        </Border>

        <!-- Form content -->
        <ScrollView IsVisible="{Binding IsNotLoading}"
                Padding="16">
            <StackLayout Spacing="20">

                <!-- Subscription Name -->
                <StackLayout>
                    <Label Text="Subscription Name"
                            FontAttributes="Bold"/>
                    <Entry Text="{Binding Subscription.Name}"
                           Placeholder="Enter subscription name"
                           BackgroundColor="White"
                           Margin="0,5,0,0"/>
                </StackLayout>

                <!-- Provider -->
                <StackLayout>
                    <Label Text="Provider"
                            FontAttributes="Bold"/>
                    <Entry Text="{Binding Subscription.Provider}"
                           Placeholder="Enter provider name"
                           BackgroundColor="White"
                           Margin="0,5,0,0"/>
                </StackLayout>

                <!-- Amount -->
                <StackLayout>
                    <Label Text="Amount"
                            FontAttributes="Bold"/>
                    <Entry Text="{Binding Subscription.Amount}"
                           Placeholder="0.00"
                           Keyboard="Numeric"
                           BackgroundColor="White"
                           Margin="0,5,0,0"/>
                </StackLayout>

                <!-- Billing Cycle -->
                <StackLayout>
                    <Label Text="Billing Cycle"
                            FontAttributes="Bold"/>
                    <Picker ItemsSource="{Binding BillingCycles}"
                            SelectedItem="{Binding Subscription.BillingCycle}"
                            BackgroundColor="White"
                            Margin="0,5,0,0"/>
                </StackLayout>

                <!-- Category -->
                <StackLayout>
                    <Label Text="Category"
                            FontAttributes="Bold"/>
                    <Entry Text="{Binding Subscription.Category}"
                           Placeholder="Enter category"
                           BackgroundColor="White"
                           Margin="0,5,0,0"/>
                </StackLayout>

                <!-- Description -->
                <StackLayout>
                    <Label Text="Description"
                            FontAttributes="Bold"/>
                    <Editor Text="{Binding Subscription.Description}"
                            Placeholder="Enter description"
                            BackgroundColor="White"
                            HeightRequest="100"
                            Margin="0,5,0,0"/>
                </StackLayout>

                <!-- Next Billing Date -->
                <StackLayout>
                    <Label Text="Next Billing Date"
                            FontAttributes="Bold"/>
                    <DatePicker Date="{Binding Subscription.NextBillingDate}"
                                BackgroundColor="White"
                                Margin="0,5,0,0"/>
                </StackLayout>

                <!-- Active Status -->
                <StackLayout Orientation="Horizontal"
                        Spacing="10">
                    <Label Text="Active"
                            FontAttributes="Bold"
                            VerticalOptions="Center"/>
                    <Switch IsToggled="{Binding Subscription.IsActive}"/>
                </StackLayout>

                <!-- Action Buttons -->
                <Grid ColumnDefinitions="*,*"
                        ColumnSpacing="10"
                        Margin="0,20,0,0">
                    <Button Grid.Column="0"
                            Text="Save"
                            Command="{Binding SaveCommand}"
                            BackgroundColor="Green"
                            TextColor="White"
                            IsEnabled="{Binding IsNotLoading}"/>
                    <Button Grid.Column="1"
                            Text="Cancel"
                            Command="{Binding CancelCommand}"
                            BackgroundColor="Gray"
                            TextColor="White"/>
                </Grid>

            </StackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
